# Makefile for creating the Matlab MEX function for the das3 implicit model
# This Makefile was formatted for Microsoft's NMAKE.EXE

# Makefile for das3

MEX = mex											# this should go to the mex.bat file in the current Matlab version
CC = "C:\Program Files\LLVM\bin\clang-cl.exe"		# clang compiler
# compiler options for C compiler (add /O2 for slower compile and faster execution)
CFLAGS=/nologo /w /O2				
MEXOPTS = 

# the first target is the actual mex function
das3mex.mexw64: das3mex.c das3mex.h das3_al.obj
		@echo Compiling das3mex.c...
		$(MEX) $(MEXOPTS) das3mex.c das3_al.obj

# the following is the compilation of C code generated by Autolev
das3_al.obj:	das3_al.c das3mex.h
		@echo Compiling C code generated by Autolev, may take some time...
		@echo Without /O2 option: 30 seconds, with /O2 option: 20 minutes.
		$(CC) $(CFLAGS) /c das3_al.c

# clean the raw C code generated by Autolev
das3_al.c: das3_al_raw.c autolevclean.exe
		@echo cleaning das3_al_raw.c to produce das3_al.c...
		autolevclean.exe

# make the program that cleans the Autolev C code
autolevclean.exe: autolevclean.c
		$(CC) $(CFLAGS) autolevclean.c

# run Autolev on Ton's computer, when das3_al_raw.c is outdated
!IF "$(COMPUTERNAME)" == "LRI-102855"
das3_al_raw.c: das3.al contact.a sym_atan2.r
		"C:\Users\Ton\Documents\Software\Autolev\al.exe" das3.al >NUL
		del das3_al_raw.in				# .in file is generated by autolev but not needed
!ENDIF






